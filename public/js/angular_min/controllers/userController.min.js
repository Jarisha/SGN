var UserController=["$scope","$rootScope","$http","$location","$routeParams","resolveUser","gamepinService",function(e,t,n,r,i,s,o){console.log("UserController");t.css="profile";t.title="user";e.activityPins=s.activityData;e.timeline=s.timeline;e.user=s.profileData;e.user.bio=e.user.bio||null;e.showPins=e.activityPins;e.bigPin={};e.bigPin.followBtn=false;e.isFollowing=false;e.isFriend=false;e.displayMode={};e.displayMode.activity=true;e.displayMode.group=false;e.groupList=[];e.groupData={};e.showGroup=null;e.FOLLOW=1;e.FRIEND=2;e.GROUPS=1;e.POSTS=2;e.LIKES=3;e.ACTIVITY=4;e.people_tab=e.FOLLOW;e.content_tab=e.ACTIVITY;e.timeline_tab="showAll";e.modals=t.rootPath+"/partials/modals";for(var u in e.timeline){var a=e.timeline[u];if(a.action==="commentPosted"){a.message="Comment posted to "+a.target;switch(a.target){case"Action & Adventure":a.sourceImg="/images/caticon-action22x22.png";break;case"Arcade":a.sourceImg="/images/caticon-arcade22x22.png";break;case"Board & Card":a.sourceImg="/images/caticon-card22x22.png";break;case"Casino & Gambling":a.sourceImg="/images/caticon-casino22x22.png";break;case"Educational":a.sourceImg="/images/caticon-educational22x22.png";break;case"Family & Kids":a.sourceImg="/images/caticon-family22x22.png";break;case"Music & Rhythm":a.sourceImg="/images/caticon-music22x22.png";break;case"Puzzle":a.sourceImg="/images/caticon-puzzle22x22.png";break;case"Racing":a.sourceImg="/images/caticon-racing22x22.png";break;case"Role Playing":a.sourceImg="/images/caticon-rpg22x22.png";break;case"Simulation":a.sourceImg="/images/caticon-simulation22x22.png";break;case"Sports":a.sourceImg="/images/caticon-sports22x22.png";break;case"Strategy":a.sourceImg="/images/caticon-strategy22x22.png";break;case"Trivia & Word":a.sourceImg="/images/caticon-arcade22x22.png";break;default:alert("event image: default case");break}}else if(a.action==="gamepinPosted"){a.message="Posted to "+a.target;switch(a.target){case"Action & Adventure":a.sourceImg="/images/caticon-action22x22.png";break;case"Arcade":a.sourceImg="/images/caticon-arcade22x22.png";break;case"Board & Card":a.sourceImg="/images/caticon-card22x22.png";break;case"Casino & Gambling":a.sourceImg="/images/caticon-casino22x22.png";break;case"Educational":a.sourceImg="/images/caticon-educational22x22.png";break;case"Family & Kids":a.sourceImg="/images/caticon-family22x22.png";break;case"Music & Rhythm":a.sourceImg="/images/caticon-music22x22.png";break;case"Puzzle":a.sourceImg="/images/caticon-puzzle22x22.png";break;case"Racing":a.sourceImg="/images/caticon-racing22x22.png";break;case"Role Playing":a.sourceImg="/images/caticon-rpg22x22.png";break;case"Simulation":a.sourceImg="/images/caticon-simulation22x22.png";break;case"Sports":a.sourceImg="/images/caticon-sports22x22.png";break;case"Strategy":a.sourceImg="/images/caticon-strategy22x22.png";break;case"Trivia & Word":a.sourceImg="/images/caticon-arcade22x22.png";break;default:alert("event image: default case");break}}else if(a.action==="followSent"){a.message="Following "+a.targetData.userName;a.sourceImg=a.targetData.profileImg||"/images/30x30.gif"}else if(a.action==="friendAccepted"){if(a.targetData.userName!==e.user.userName){a.message="Friended "+a.targetData.userName;a.sourceImg=a.targetData.profileImg||"/images/30x30.gif";a.targetLink="/user/"+a.targetData.userName}else{a.message="Friended "+a.sourceData.userName;a.sourceImg=a.sourceData.profileImg||"/images/30x30.gif";a.targetLink="/user/"+a.sourceData.userName}}}for(var f=0,l=e.user.followers.length;f<l;f++){if(e.user.followers[f].userName===t.userName){e.isFollowing=true;break}}for(var f=0,l=e.user.friends.length;f<l;f++){if(e.user.friends[f].userName===t.userName){e.isFriend=true;break}}e.masonInit=true;e.changeState=function(){e.masonInit=false};e.setup=function(){$(window).scroll(function(){if($(this).scrollTop()>200){$("#scrollup").fadeIn()}else{$("#scrollup").fadeOut()}});var t=$(".change_avatar");e.scrollup=function(){$("html, body").animate({scrollTop:0},600)}};e.viewBigPin=function(r){o.getPinData(r.id,function(i){e.bigPin=r;e.bigPin.gameName=i.gameName;e.bigPin.publisher=i.publisher;e.bigPin.datePosted=i.datePosted;e.bigPin.videoEmbed=i.videoEmbed;e.bigPin.comments=i.comments;e.bigPin.profileImg=i.profileImg||t.rootPath+"/images/30x30.gif";if(e.bigPin.videoEmbed){var s=$.parseHTML(e.bigPin.videoEmbed);s[0].width="560";s[0].height="341";$(".view_vid").append(s)}$("#gamePinModal").modal({dynamic:true});n({method:"post",url:"/api/getFollowers",data:{email:t.userEmail}}).success(function(n,r,i,s){if(n.error)t.popNotify("Error",n.error);else if(n.success){var o=n.following;if(o.indexOf(e.bigPin.posterId)!==-1)e.bigPin.followBtn=false;else e.bigPin.followBtn=true}}).error(function(e,t,n,r){console.log(e)})})};e.addBigComment=function(r,i){e.bigPin.comments.push({posterName:t.userName,content:r,posterImg:t.userImg});n({method:"post",url:"/api/gamepin/addComment",data:{pinId:e.bigPin.id,posterId:t.userEmail,posterName:t.userName,content:r}}).success(function(e,t,n,r){$("textarea.view_respond_txtarea").val("")}).error(function(e,t,n,r){})};e.follow=function(n){var r=t.follow(n);r.then(function(e){$("#follow_user").attr("disabled","disabled")},function(t){console.log("$rootScope follow failed");e.bigFollowBtn=false})};e.popMessage=function(){function o(){var n=false;var o=false;for(var u in s.conversations){if(s.conversations[u]&&s.conversations[u].target===i){n=true;break}}for(var a in e.user.conversations){if(e.user.conversations[a]&&e.user.conversations[a].target===r){o=true;break}}console.log(n&&o);if(n&&o){for(var f in t.convoData){if(t.convoData[f].targetUser===i){t.popConversation(t.convoData[f])}}}else{$("#messageModal form")[0].reset();$("#messageModal").modal()}}var r=t.userEmail;var i=e.user.email;var s;n({method:"post",url:"/api/user/getProfile",data:{email:r}}).success(function(e,n,r,i){if(e.error)return t.popNotify("Error","Server Error");s=e.profileData;o()}).error(function(e,n,r,i){t.popNotify("Error","Server Error")})};e.sendMessage=function(n){var r=t.userEmail;var i=e.user.email;t.message(n,r,i,function(e,n){if(e)t.popNotify(e);else if(n)t.popNotify(n)})};e.getGroupData=function(){e.displayMode.activity=false;e.displayMode.group=true;n({method:"post",url:"/api/user/getGroups",data:{userName:e.user.userName}}).success(function(t,n,r,i){e.groupList=[];e.groupData=t.groups;for(var s in t.groups){e.groupList.push(s)}e.showPins=null}).error(function(e,t,n,r){console.log(e)})};e.showGroup=function(n){t.destroyProfileMason();e.showPins=e.groupData[n]};e.showActivity=function(){t.destroyProfileMason();e.displayMode.activity=true;e.displayMode.group=false;e.showPins=e.activityPins;t.profileMasonry()};e.showLikes=function(){t.destroyProfileMason();n({method:"post",url:"/api/user/getLikedPins",data:{email:e.user.email,pinIds:e.user.likes}}).success(function(n,r,i,s){if(n.error)t.popNotify("Error",n.error);else if(n.likedPins){e.showPins=n.likedPins}}).error(function(e,t,n,r){console.log(e)})};e.ajaxLogout=function(){t.logout(function(t){if(t.message)e.status=t.message})};e.friend=function(){n({method:"post",url:"/api/user/friendRequest",data:{sourceId:t.userEmail,targetId:e.user.email}}).success(function(e,n,r,i){if(e.success){t.popNotify(e.success)}else if(e.error){t.popNotify("Error",e.error)}}).error(function(e,t,n,r){console.log(e)})}}];UserController.resolve={resolveUser:["$q","$route","$rootScope","$location","$http","$routeParams","$window",function(e,t,n,r,i,s,o){var u=e.defer();var a=t.current.params.username;if(a===n.userName)r.path("/profile");$("#gamePinModal").modal("hide");n.checkLogin(function(e,t){if(e)u.reject();else if(!t)r.path("/");else{i({method:"post",url:"/api/user/getProfile",data:{userName:a}}).success(function(e,t,n,r){if(e.error)u.reject();u.resolve(e)}).error(function(e,t,n,r){u.reject(e)})}});return u.promise}]}