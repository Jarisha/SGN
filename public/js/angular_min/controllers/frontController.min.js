var FrontController=["$scope","$rootScope","$http","$location","$templateCache","$timeout","$routeParams","resolveFront","gamepinService","$window",function(e,t,n,r,s,o,u,a,f,l){function d(){for(p=c+h;c<p;c++){if(e.gamePins[c])e.showPins.push(e.gamePins[c]);else break}}e.showPins=[];e.gamePins=a;e.recommendedPins=[];t.css="front";e.modals=t.rootPath+"/partials/modals";e.subnav=t.rootPath+"/partials/front/front_subnav";e.nav=t.rootPath+"/partials/navbar";e.content=t.rootPath+"/partials/front_content";e.searchText="";e.appendHtml="";e.container=$("#content");e.masonInit=true;e.flag=true;e.bigPin={};e.bigPin.followBtn=true;var c=0;var h=20;var p=0;d();e.fbModal=function(){$("#fbRegisterModal").modal()};e.changeState=function(){e.masonInit=false};l.onscroll=function(t){var n=document.documentElement.scrollHeight-document.documentElement.clientHeight;var r=l.pageYOffset;if(e.flag&&n-r<=300){if(n-r<=100){$(".rackspace_logo").fadeIn()}e.$apply(e.loadMore());e.flag=false}if(n-r>=400){$(".rackspace_logo").fadeOut()}};e.setup=function(){frontSetup(e,t,n)};e.getfront=function(){t.destroyMason();e.showPins=[];f.getPinList(function(t){e.gamePins=t.objects;c=0;h=20;p=0;d()})};e.catSearch=function(t){function r(){n=e.gamePins;c=0;h=20;p=0;e.showPins=[];e.gamePins=n;d()}var n=[];f.categorySearch(t,function(t){e.gamePins=t.objects;r()})};e.textsearch=function(t){function r(){n=e.gamePins;c=0;h=20;p=0;e.showPins=[];e.gamePins=n;d()}var n=[];f.textSearch(t,function(t){e.gamePins=t.objects;r()})};e.getFollowing=function(){function o(){var n=e.gamePins.slice();var s=[];for(i=0;i<n.length;i++){if(!r[n[i].poster]){n.splice(i,1);i--}}e.gamePins=n;c=0;h=20;p=0;d();t.masonry()}var r={};var s;e.showPins=[];t.destroyMason();n({method:"post",url:"/api/user/getProfile",data:{email:t.userEmail}}).success(function(e,t,n,u){s=e.profileData.following;for(i=0,len=s.length;i<len;i++)r[s[i].userName]=true;o()}).error(function(e,t,n,r){alert(e)})};e.getPopular=function(){function r(e,t){if(e.comments.length+e.likedBy.length<t.comments.length+t.likedBy.length)return 1;else return-1}e.showPins=[];t.destroyMason();var n=e.gamePins.slice();n.sort(r);e.gamePins=n;c=0;h=20;p=0;d();t.masonry()};t.popRecommended=function(t){$("#gamePinModal").modal("hide");e.viewBigPin(t)};e.viewBigPin=function(r){console.log(e.showPins[r].poster);$(".view_vid").empty();f.getPinData(e.showPins[r].id,function(s){e.bigPin.index=r;e.bigPin=e.showPins[r];e.bigPin.posterImg=e.bigPin.posterImg||t.rootPath+"/images/30x30.gif";e.bigPin.gameName=s.gameName;e.bigPin.publisher=s.publisher;e.bigPin.datePosted=s.datePosted;e.bigPin.videoEmbed=s.videoEmbed;e.bigPin.comments=s.comments;console.log(e.bigPin.posterName+" === "+t.userName);if(e.bigPin.videoEmbed){var o=$.parseHTML(e.bigPin.videoEmbed);o[0].width="560";o[0].height="341";$(".view_vid").append(o)}e.recommendedPins=[];for(i=0,len=e.showPins.length;i<len;i++){if(e.showPins[i].category===e.bigPin.category&&e.showPins[i].id!==e.bigPin.id){e.recommendedPins.push({index:i,image:e.showPins[i].imageUrl||e.showPins[i].sourceUrl,link:"/post/"+e.showPins[i].id})}}$("#recommend_sidebar").css("display","block");$("#gamePinModal").modal({dynamic:true});n({method:"post",url:"/api/getFollowers",data:{email:t.userEmail}}).success(function(n,i,s,o){if(n.error)t.popNotify("Error",n.error);else if(n.success){var u=n.following;var a=$("#gamePinModal .follow");if(e.showPins[r].poster===t.userName||u.indexOf(e.bigPin.posterId)!==-1)e.bigFollowBtn=false;else e.bigFollowBtn=true}}).error(function(e,t,n,r){})})};e.follow=function(n){var r=t.follow(n);r.then(function(t){e.bigPin.followBtn=false},function(t){console.log("$rootScope follow failed");e.bigPin.followBtn=false})};e.setupModals=function(){t.setupPostContent();n({method:"POST",url:"/api/facebookRegister"}).success(function(e,n,r,i){if(e.fb){t.register.email=e.fbEmail;t.register.name=e.fbName;t.register.fbConnect=true;$("#fbRegisterModal").modal()}}).error(function(t,n,r,i){e.message="Server Error: "+n});if(sessionStorage.registerAlert){t.popNotify(sessionStorage.registerAlert);sessionStorage.removeItem("registerAlert")}};e.addBigComment=function(r,i){e.bigPin.comments.push({posterName:t.userName,content:r,posterImg:t.userImg});n({method:"post",url:"/api/gamepin/addComment",data:{pinId:e.bigPin.id,posterId:t.userEmail,posterName:t.userName,content:r}}).success(function(e,n,r,i){$("textarea.view_respond_txtarea").val("");t.remason()}).error(function(e,t,n,r){})};e.addComment=function(r,i){t.rootSettings;e.showPins[i].comments.push({posterName:t.userName,content:r,posterImg:t.userImg});n({method:"post",url:"/api/gamepin/addComment",data:{pinId:e.showPins[i].id,posterId:t.userEmail,posterName:t.userName,content:r}}).success(function(n,r,i,s){if(n.error);e.text=null;t.remason()}).error(function(e,t,n,r){"error"})};e.loadMore=function(){console.log("loadMore");var n=false;var r=[];for(p=c+h;c<p;c++){if(e.gamePins[c]){r.push(e.gamePins[c])}}e.showPins=e.showPins.concat(r);t.reload();o(function(){e.flag=true},100)};e.loadOne=function(){"load Zs";e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});e.showPins.push({id:"Z",description:"Z",poster:"Z",category:"Z"});o(function(){e.flag=true},100)};e.affix=function(){$("#subnav").affix({offset:42})}}];FrontController.resolve={resolveFront:["$q","$rootScope","gamepinService",function(e,t,n){var r=e.defer();$("#gamePinModal").modal("hide");t.checkLogin(function(e,t){if(e)r.reject(e);n.getPinList(function(e){if(e.objects){r.resolve(e.objects)}else r.reject("Error")})});return r.promise}]}