var app=angular.module("myApp",["myApp.services","myApp.directives","myApp.filters"]);app.config(["$routeProvider","$locationProvider",function(e,t){console.log("app.config()");e.when("/",{templateUrl:"/partials/front/front",controller:FrontController,resolve:FrontController.resolve}).when("/store",{templateUrl:"/partials/store",controller:StoreController,resolve:StoreController.resolve}).when("/profile",{templateUrl:"/partials/profile/profile",controller:ProfileController,resolve:ProfileController.resolve}).when("/about",{templateUrl:"/partials/about/about",controller:AboutController,resolve:AboutController.resolve}).when("/about/:area",{templateUrl:"/partials/about/about",controller:AboutController,resolve:AboutController.resolve}).when("/user/:username",{templateUrl:"/partials/user/user",controller:UserController,resolve:UserController.resolve}).when("/post/:postId",{templateUrl:"/partials/post/post",controller:TempController,resolve:TempController.resolve}).when("/notfound",{templateUrl:"/partials/not_found"}).otherwise({templateUrl:"/partials/not_found"});t.html5Mode(true).hashPrefix("!")}]);app.run(["$rootScope","$http","$templateCache","$location","$timeout","$q",function(e,t,n,r,s,o){function u(){if(e.badInput){$("#imageUrlModal form").resetForm();$("#imageUrlModal .urlInput").val("");$("#imageUrlModal .thumbnail").empty();$("#fileUploadModal form").resetForm();$("#fileUploadModal .thumbnail").empty();$("#youtubeModal form").resetForm();$("#youtubeModal .urlInput").val("");$("#youtubeModal .fileupload").empty()}else{$("#imageUrlModal form").resetForm();$("#imageUrlModal .urlInput").val("");$("#imageUrlModal .thumbnail").empty();$("#fileUploadModal form").resetForm();$("#fileUploadModal .thumbnail").empty();$("#youtubeModal form").resetForm();$("#youtubeModal .urlInput").val("");$("#youtubeModal .fileupload").empty()}$('#imageUrlForm input[type="submit"],                   #uploadForm input[type="submit"],                   #youtubeUrlForm input[type="submit"]').attr("disabled","disabled")}console.log("app.run()");e.notificationsDummyData={followersData:[{sourceUser:"user7@u.u",action:"followRecieved",target:"dtonys@gmail.com",sourceData:{email:"user7@u.u",userName:"user7",profileImg:"http://d45c79c0838c7014df33-00861601181b32db2671b5497da6d8c8.r84.cf1.rackcdn.com/GJUhS9F1oZEJaGD26kwOSdtg"}},{sourceUser:"user7@u.u",action:"followRecieved",target:"dtonys@gmail.com",sourceData:{email:"user7@u.u",userName:"user7",profileImg:"http://d45c79c0838c7014df33-00861601181b32db2671b5497da6d8c8.r84.cf1.rackcdn.com/GJUhS9F1oZEJaGD26kwOSdtg"}},{sourceUser:"user7@u.u",action:"followRecieved",target:"dtonys@gmail.com",sourceData:{email:"user7@u.u",userName:"user7",profileImg:"http://d45c79c0838c7014df33-00861601181b32db2671b5497da6d8c8.r84.cf1.rackcdn.com/GJUhS9F1oZEJaGD26kwOSdtg"}},{sourceUser:"user7@u.u",action:"followRecieved",target:"dtonys@gmail.com",sourceData:{email:"user7@u.u",userName:"user7",profileImg:"http://d45c79c0838c7014df33-00861601181b32db2671b5497da6d8c8.r84.cf1.rackcdn.com/GJUhS9F1oZEJaGD26kwOSdtg"}},{sourceUser:"user7@u.u",action:"followRecieved",target:"dtonys@gmail.com",sourceData:{email:"user7@u.u",userName:"user7",profileImg:"http://d45c79c0838c7014df33-00861601181b32db2671b5497da6d8c8.r84.cf1.rackcdn.com/GJUhS9F1oZEJaGD26kwOSdtg"}}],tagsData:[{name:"Bertha",target:"pin",time:3},{name:"Joan",target:"comment",time:4}],messagesData:[{name:"Jill",time:5}]};e.badInput=false;if(!Modernizr.input.placeholder)e.badInput=true;e.newConvos=0;e.convoData=[];e.selectedConvo;e.messageList;e.$on("$routeChangeStart",function(e,t,n){console.log("Route Change Started!");$("body").css("cursor","wait")});e.$on("$routeChangeSuccess",function(e,t,n){$("body").css("cursor","default")});e.$on("$routeChangeError",function(e,t,n,r){});e.$on("$viewContentLoaded",function(e,t,n,r){});e.log=function(e){console.log(e)};e.alert=function(e){alert(e)};e.loggedIn=null;e.userName=null;e.userEmail=null;e.userImg="/images/30x30.gif";e.set={password:null,confirm:null,userName:null,gender:null};e.post={url:null,content:null,name:null,publisher:null,description:null,category:null};e.section="";e.rootPath="";t.get("/api/getPath").success(function(t,n,r,i){e.rootPath=t.path}).error(function(e,t,n,r){result.message="Error: "+t});e.popModal=function(){$("#changeAvatar").modal()};e.masonry=function(){console.log("masonry");$("img").imagesLoaded(function(){$("#content").masonry({itemSelector:".game_pin, .store_pin",isFitWidth:true});s(function(){console.log("time");$("#content").masonry("reload")},1e3)})};e.reload=function(){console.log("appendMason");$("img").imagesLoaded(function(){$("#content").masonry("reload")})};e.remason=function(){$("#content").masonry("reload")};e.destroyMason=function(){$("#content").masonry("destroy")};e.profileMasonry=function(){$("#profile_data_inner").imagesLoaded(function(){$("#profile_data_inner").masonry({itemSelector:".game_pin",isFitWidth:true});s(function(){$("#profile_data_inner").masonry("reload")},1e3)})};e.profileReload=function(){console.log("reload profile masonry");$("#profile_data_inner").imagesLoaded(function(){$("#profile_data_inner").masonry("reload")})};e.destroyProfileMason=function(){$("#profile_data_inner").masonry("destroy")};e.postGamePin=function(){e.post.name=null;e.post.publisher=null;e.post.category=null;e.post.description=null;e.post.url=null;e.post.content=null;u();$("#postModal").modal()};e.popGeneric=function(){$("#genericModal").modal()};e.popFeedback=function(){$("#feedbackModal form")[0].reset();$("#feedbackModal").modal()};e.popConversation=function(n){t({method:"post",url:"/api/user/getMessages",data:{convoId:n.id}}).success(function(t,r,i,s){if(t.messages){e.messageList=t.messages;e.selectedConvo=n}}).error(function(e,t,n,r){});$("#convo_sidebar").css("display","block");$("#conversationModal").modal();$("#respond_message").focus();var r=$(".convo_right")[0].scrollHeight;$(".convo_right").scrollTop(r)};e.popImageUrl=function(){$("#postModal").modal("hide");$("#imageUrlModal").modal()};e.popFileUpload=function(){$("#postModal").modal("hide");$("#fileUploadModal").modal()};e.popYoutubeUrl=function(){$("#postModal").modal("hide");$("#youtubeModal").modal()};e.popFollowerNotifications=function(){$("#followerNotificationsModal").modal()};e.popBadgeModal=function(){$("#badgeModal").modal()};e.closeModal=function(e){console.log("close gamePinModal");$("#gamePinModal").modal("hide");s(function(){r.path(e.link)},10)};var a=null;e.popNotify=function(e,t){$("#alertContainer").removeClass();$("#notify_status").text(e);$("#notify_message").text(t);if(e==="Error"){$("#alertContainer").addClass("errorAlert")}else{$("#alertContainer").addClass("successAlert")}$("#alertContainer").show();a=s(function(){$("#alertContainer").fadeOut(500,function(){$("#notify_message").text("")})},5e3)};e.hideNotify=function(){s.cancel(a);$("#alertContainer").fadeOut(250,function(){$("#notify_message").text("")})};e.checkLogin=function(n){var r={};t({method:"POST",url:"/api/checkLogin"}).success(function(t,s,o,u){if(t.loggedIn){e.loggedIn=true;e.userName=t.userName;e.userEmail=t.userId;e.userImg=t.avatarImg||"/images/30x30.gif";e.userEvents=t.userEvents;e.pinEvents=t.pinEvents;e.convoData=t.convoData;for(i=0,len=e.convoData.length;i<len;i++){if(e.convoData[i].notify===t.userId){e.newConvos++;e.convoData[i].newFlag=true}}return n(null,true)}else if(!t.loggedIn){e.loggedIn=false;e.userName=null;e.userEmail=null;e.userImg=null;return n(null,false)}else{r.status="AJAX error";next("AJAX error",true);return n("AJAX error",null)}}).error(function(e,t,i,s){r.message="Error: "+t;return n(t,null)})};e.logoutSubmit=function(){var n={};t({method:"POST",url:"/api/logout"}).success(function(t,n,r,i){if(t.logout){e.loggedIn=false;e.userName=null;window.location="/"}}).error(function(e,t,r,i){n.message="Error: "+t})};e.follow=function(n){var r=o.defer();t({method:"post",url:"/api/user/follow",data:{sourceId:e.userEmail,targetName:n}}).success(function(t,i,s,o){if(t.error){console.log("error");e.popNotify("Error","Follow "+targetName+" failed");r.resolve(false)}else{console.log("success");e.popNotify("Success","Now Following "+n);r.resolve(true)}}).error(function(e,t,n,r){console.log(e)});return r.promise};e.like=function(n){t({method:"post",url:"/api/gamepin/like",data:{pinId:n.id,email:e.userEmail}}).success(function(t,r,i,s){if(t.error)e.popNotify("Error",t.error);else if(t.success){e.popNotify("Success",t.success);n.likedFlag=!n.likedFlag;n.likedBy.length++}}).error(function(t,n,r,i){e.popNotify("Error","Server Error")})};e.unlike=function(n){t({method:"post",url:"/api/gamepin/unlike",data:{pinId:n.id,email:e.userEmail}}).success(function(t,r,i,s){if(t.error)e.popNotify("Error",t.error);else if(t.success){e.popNotify("Success",t.success);n.likedFlag=!n.likedFlag;n.likedBy.length--}}).error(function(t,n,r,i){e.popNotify("Error","Server Error")})};e.sendFeedback=function(n){t({method:"post",url:"/api/user/submitFeedback",data:{sourceUser:e.userEmail,content:n}}).success(function(e,t,n,r){if(e.success){$("#feedbackModal").modal("hide")}if(e.error)alert(e.error)}).error(function(e,t,n,r){if(e)alert(e)})};e.message=function(e,n,r,i){t({method:"post",url:"/api/user/message",data:{sourceId:n,targetId:r,content:e}}).success(function(e,t,n,r){if(e.success){return i(null,JSON.stringify(e.success))}if(e.error){return i(JSON.stringify(e.error),null)}}).error(function(e,t,n,r){if(e)alert(e)})};e.respond=function(n){t({method:"post",url:"/api/user/message",data:{sourceId:e.userEmail,targetId:e.selectedConvo.showUser.email,content:n}}).success(function(t,r,i,s){if(t.success){e.messageList.push({sourceData:{userName:e.userName,profileImg:e.userImg},content:n})}if(t.error)alert(JSON.stringify(t.error))}).error(function(e,t,n,r){if(e)alert(e)})};e.consume=function(e,n,i){console.log("consume + proceed to targetLink");if(e.action==="friendRequest"){r.path(e.targetLink);return}i.splice(n,1);t({method:"post",url:"/api/user/consumeEvent",data:{eventId:e.id}}).success(function(t,n,i,s){r.path(e.targetLink)}).error(function(e,t,n,r){console.log("error")})};e.consumeMessage=function(n){if(e.newConvos<=0)return;e.newConvos--;n.newFlag=false;t({method:"post",url:"/api/user/consumeMessage",data:{convoId:n.id}}).success(function(e,t,n,r){if(e.success){}else if(e.error){alert(e.error)}}).error(function(e,t,n,r){alert(e)})};e.ignore=function(n,r,i){t({method:"post",url:"/api/user/consumeEvent",data:{eventId:n.id}}).success(function(t,n,s,o){if(t.success){i.splice(r,1);e.popNotify("Success","Request Ignored")}if(t.error){e.popNotify("Error",t.error)}}).error(function(t,n,r,i){console.log(t);e.popNotify("Error","Server Error")})};e.acceptFriend=function(n,r,i){console.log("sourceId: "+n.sourceUser+" targetId: "+e.userEmail+" consumedId: "+n.id);t({method:"post",url:"/api/user/acceptFriend",data:{sourceId:n.sourceUser,targetId:n.target,consumedId:n.id}}).success(function(t,n,s,o){if(t.success){i.splice(r,1);e.popNotify("Success","Friend Accepted")}if(t.error){e.popNotify("Error",t.error)}}).error(function(t,n,r,i){console.log(t);e.popNotify("Error","Server Error")})};e.viewSettings=function(){var n;e.set.password=null;e.set.confirm=null;t({method:"post",url:"/api/getSettings",data:{email:e.userEmail}}).success(function(t,n,r,i){if(t.error)e.popNotify("Error",t.error);if(t.success){e.set.gender=t.gender;e.set.userName=t.userName;$("#settingsModal").modal()}}).error(function(t,n,r,i){e.popNotify("Error",t)})};e.editSettings=function(){t({method:"POST",url:"/api/editSettings",data:{email:e.userEmail,settings:e.set}}).success(function(t,n,r,i){if(t.error){e.popNotify("Error",t.error)}if(t.success){if(t.userName)e.userName=t.userName;e.popNotify("Success",t.notify)}e.set.password=null;e.set.confirm=null}).error(function(e,t,n,r){})};e.setupPostContent=function(){function s(e,t){$.ajax({type:"post",url:"/api/util/validImg",data:"url="+e,success:function(e){if(e.valid){t(true,e.contentType)}else{t(false,null)}},error:function(e){t(false,null)}})}function l(e,t){$.ajax({type:"post",url:"/api/util/validVideo",data:"url="+u,success:function(e){if(e.valid){t(true,e)}else{t(false,null)}},error:function(e){t(false,null)}})}$("input, textarea").placeholder();$(".btn-file input").click(function(e){$("#uploadForm .fileSubmit").removeAttr("disabled")});$("#uploadForm a[data-dismiss='fileupload']").click(function(e){$("#uploadForm .fileSubmit").attr("disabled","disabled")});$("#uploadForm").submit(function(){$("#"+$(this)[0].id+' input[type="submit"]').attr("disabled","disabled");$("#fileUploadModal *").css("cursor","wait");$(this).ajaxSubmit({beforeSubmit:function(e,t,n){percent=0;setTimeout(function(){},5e3)},uploadProgress:function(e,t,n,r){var i=r},success:function(t,n,r,i){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#fileUploadModal *").css("cursor","auto");if(t.error){return}$("#fileUploadModal").modal("hide");e.popNotify("Success","Post Image Success!")},error:function(e,t,n,r){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#fileUploadModal *").css("cursor","auto");r.css("cursor","auto")},dataType:"json"});return false});var t=$(".get_image");var n=$("#imageUrlForm").find(".thumbnail");var r;var i;t.click(function(e){r=t.next(".urlInput").val();s(r,function(e,t){if(!e){return}i=t;$("#imageUrlForm .fileSubmit").removeAttr("disabled");n.empty();n.append('<img src="'+r+'"/>')})});$("#imageUrlForm").submit(function(t){$("#"+$(this)[0].id+' input[type="submit"]').attr("disabled","disabled");$("#imageUrlModal *").css("cursor","wait");$.ajax({type:"post",url:"/api/gamepin/postImageUrl",data:$(this).serialize()+"&url="+r+"&type="+i,success:function(t){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#imageUrlModal *").css("cursor","auto");if(t.error){$("#imageUrlModal").modal("hide");e.popNotify(t.error);return}$("#imageUrlModal").modal("hide");e.popNotify("Post Image Success!")},error:function(e){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#imageUrlModal *").css("cursor","auto")}});return false});var o=$(".get_video");var u;var a;var f;o.click(function(){u=o.next(".urlInput").val();l(u,function(e,t){if(!e){return}a=t.url;f=t.embed;$("#youtubeModal .fileupload-new").append(t.embed);$("#youtubeModal .fileSubmit").removeAttr("disabled")})});$("#youtubeUrlForm").submit(function(t){$("#"+$(this)[0].id+' input[type="submit"]').attr("disabled","disabled");$("#youtubeUrlForm *").css("cursor","wait");$.ajax({type:"post",url:"/api/gamepin/postYoutubeUrl",data:$(this).serialize()+"&imgUrl="+a+"&embedHtml="+f,success:function(t){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#youtubeUrlForm *").css("cursor","auto");if(t.error){return}$("#youtubeModal").modal("hide");e.popNotify("Post Video Success!")},error:function(){$("#"+$(this)[0].id+' input[type="submit"]').removeAttr("disabled");$("#youtubeUrlForm *").css("cursor","auto")}});return false});$("#uploadAvatar").submit(function(){$(this).ajaxSubmit({success:function(e,t,n,r){if(e.error){return}window.location="/register"},error:function(e,t,n,r){},dataType:"json"});return false});e.changeavatar=function(){$("#changeAvatar").modal();$("#changeAvatarForm").submit(function(){$("#changeAvatar :submit").attr("disabled","disabled");$("#changeAvatar *").css("cursor","wait");$(this).ajaxSubmit({dataType:"text",success:function(t,n,r,i){$("#changeAvatar :submit").removeAttr("disabled");$("#changeAvatar *").css("cursor","auto");window.location="/profile";if(t.error){return}$("#changeAvatar").modal("hide");e.popNotify(t.success)},error:function(e,t,n,r){$("#changeAvatar :submit").removeAttr("disabled");$("#changeAvatar *").css("cursor","auto")}});return false})}}}])